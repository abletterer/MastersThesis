%!TEX root = ../thesis.tex

% \pagebreak[4]
% \hspace*{1cm}
% \pagebreak[4]
% \hspace*{1cm}
% \pagebreak[4]

\chapter{Déformation à base de cage}

\graphicspath{ {Chapter2/Chapter2Figs/PNG/}
  {Chapter2/Chapter2Figs/PDF/} {Chapter2/Chapter2Figs/} }

Notre travail s'est porté particulièrement sur le mélange de différents outils
de dimension 2 (faces). La technique retenue pour cette dimension est celle
des déformations à base de cage. Ce choix a été motivé par l'efficacité de
cette méthode et de son utilisation dans le travail de \cite{GPCP13} (un
travail similaire à celui que nous souhaitions réaliser).

Afin de pouvoir rentrer dans les détails des méthodes existantes, ainsi que
des idées que nous avons eu, une introduction aux déformations à base de cage
est nécessaire. Ces déformations peuvent se faire dans $\mathbb{R}^2$ (l'outil
est un polygone) et dans $\mathbb{R}^3$ (l'outil est une surface), mais pour
simplifier la compréhension de la méthode ainsi que les différents schémas,
nous nous concentrerons sur des déformations dans $\mathbb{R}^2$.

\section{Introduction} 

L'outil permettant de réaliser les déformations est un polygone. Ce polygone
peut-être de nature quelconque, sous réserve qu'il ne soit pas dégénéré (il
doit avoir au moins 3 sommets) et qu'il ne comporte pas d'auto-intersection.
Par la suite l'appelerons indifféremment le \textit{polygone de contrôle} ou
\textit{cage} par rapport au sommet $v_j$. L'idée est de paramétriser la
position des sommets d'un objet contenus à l'intérieur d'un polygone de
contrôle en fonction de la position des sommets de ce polygone. Cette méthode
permet de déformer un objet uniquement en manipulant les sommets du polygone
de contrôle, peu importe la complexité de cet objet. Cette déformation est
dite globale, car un sommet du polygone de contrôle a une influence sur tous
les points de l'espace (qui sont les sommets de l'objet) contenus à
l'intérieur du polygone.

Les méthodes présentées ci-dessous permettent de réaliser les étapes
d'association d'un objet à un outil et de déformation d'un objet.

Les premiers travaux dans ce domaine ont été réalisés par \cite{JSW05}
\cite{FKR05} (réalisés simultanément), en utilisant la technique des Mean
Value Coordinates (MVC) (développée par \cite{Flo03}). Il s'agit de la
première méthode à avoir appliqué des coordonnées barycentriques généralisées
pour réaliser des déformations. Les coordonnées barycentriques généralisées
correspondent à la généralisation du calcul de coordonnées barycentriques, en
ne considérant plus des coordonnées calculées par rapport à un simplexe
(triangle dans $\mathbb{R}^2$), mais à une cellule (polygone dans
$\mathbb{R}^2$). Néanmoins cette méthode comporte un important défaut : les
coordonnées calculées peuvent être négatives (dans le cas d'un polygone de
contrôle concave par exemple), ce qui peut amener à obtenir des résultats
contre-intuitifs.

\cite{JMDGS07} ont déclaré que l'importance de ce problème devait amener à ne
pas utiliser les MVC pour l'animation de personnages. A la place, ils ont
proposé une approche différente, qui ne produisait pas de coordonnées
négatives : les Harmonic Coordinates (HC). Cette méthode a permis d'obtenir
des déformations plus localisées, mais au prix d'une complexité en temps de
calcul beaucoup plus importante et d'une discrétisation de l'espace assez
fine.

Dans la même optique, \cite{LKCL07} proposent une amélioration des Mean Value
Coordinates qui les rend positives. L'idée est de se baser sur un test de
visibilité lors du calcul des coordonnées. Ils ont pu obtenir des résultats
similaires à \cite{JMDGS07} mais pour une complexité en temps de calcul proche
de celle des MVC.

\cite{LLC08} ont constaté que les détails de la surface n'étaient pas
préservés, en particulier lors de déformations importantes. Ce qui les a amené
à développer une approche considérant plus de données lors de l'association
entre la cage et l'objet : les Green Coordinates (GC). Au lieu d'utiliser
uniquement la position des sommets de la cage, les Green Coordinates utilisent
aussi les normales aux faces de la cage.

\section{Mean Value Coordinates}

Dans le cadre de notre travail, nous avons choisi de travailler avec une seule
méthode de calcul des coordonnées. Le choix que nous avons fait s'est porté
sur les MVC. C'est actuellement la méthode de calcul des coordonnées qui a la
plus faible complexité en temps de calcul. De plus, ayant déjà travaillé sur
cette méthode, nous avions déjà fait une première implémentation de la
méthode. La réutiliser nous permettait de plus concentrer notre travail sur la
partie mélange de coordonnées. Néanmoins, la méthode apportée par notre
travail ne se limitera pas aux coordonnées MVC, mais pourra être généralisée à
d'autres méthodes de calcul de coordonnées qui partagent des propriétés en
commun.

\subsection{Coordonnées barycentriques}

\cite{Mob27} a été le premier à exprimer une relation entre un polygone et un
point contenu à l'intérieur de ce polygone (un triangle en l'occurence) : les
Coordonnées Barycentriques. Le problème était de se demander : Quels poids
doit- on donner à chacun des sommets d'un triangle de façon à ce qu'un point
$p$ soit le centre de gravité de ces sommets?

Soit $V = \{v_1, v_2, v_3\}$ un triangle quelconque, ses sommets constituent ce
qu'on appelle un repère barycentrique, et soit $p$ un point de l'espace. On dit
que $p$ est un barycentre de $V$ si et seulement si:

\begin{equation}
  p = \frac{w_1 v_1 + w_2 v_2 + w_3 v_3}{w_1+w_2+w_3}
\end{equation}

Où $w_i$ correspond à la coordonnée du point $p$ associée au sommet $v_i$,
pour $0 < i < 3$. On peut réécrire cette formule en normalisant les $w_i$ :

\begin{equation}
  \lambda_i = \frac{w_i}{w_1+w_2+w_3} ~, 1 \leq i \leq 3, 
\end{equation}

On obtient donc la formulation suivante :

\begin{equation}
  p = \lambda_1 v_1 + \lambda_2 v_2 + \lambda_3 v_3
\end{equation}

Ces coordonnés ont l'avantage d'établir une relation entre les $w_i$ d'un
point $p$ et l'aire du triangle $[v, v_{i+1}, v_{i+2}]$.

Les coordonnées barycentriques sont une transformation linéaire des
coordonnées cartésiennes, elles varient donc de façon linéaire sur le plan
défini par le triangle $V$. Ce qui signifie qu'elle peuvent être utilisées
comme une fonction d'interpolation $f(v)$ des valeurs au sommets du triangle
$f(v_i)$:

\begin{equation}
  f(v) = \sum_{i=1}^{3} \lambda_i f(v_i)
\end{equation}

\subsection{Coordonnées barycentriques généralisées}

Soit $V = \{v_1, v_2, ..., v_n\}$ un polygone simple (sans auto-intersection),
ses sommets constituent un repère barycentrique, et soit $p$ un point de
l'espace. Le but est d'étudier les poids $\lambda_i$ tels que :

\begin{equation}
  p = \sum_{i=1}^{n} \lambda_i v_i ,
  ~ \forall i \in \mathbb{N} ,~ 1 \leq i \leq n
\end{equation}

\begin{equation}
  \sum_{i=1}^n \lambda_i = 1
\end{equation}

Où $\lambda_i$ est la coordonnée (normalisée) du point $p$ associée au sommet
$v_i$ :

\begin{equation}
  \lambda_i = \frac{w_i}{\sum_{j=1}^n w_j}
\end{equation}

Le calcul des coordonnées $w_i$ n'est plus aussi évident que pour le cas du
triangle. Contrairement aux coordonnées barycentriques, les coordonnées
barycentriques généralisées ne sont pas uniques. Plusieurs méthodes ont été
mises en place, et nous nous sommes intéressés particulièrement au travail de
\cite{Flo03}.

\subsection{Calcul des coordonnées}

La motivation derrière ce travail a été de reproduire le comportement de
fonctions harmoniques. Une fonction $u$ définie dans un plan $\Omega$ est dite
harmonique si elle est $C^2$ et qu'elle satisfait l'équation de Laplace :

\begin{equation}
  \frac{\partial^2 u}{\partial x^2} + \frac{\partial^2 u}{\partial y^2} = 0
\end{equation}

Ces fonctions n'ayant pas de forme analytique, la seule façon de connaître
leur valeur en un points précis est de les évaluer sur tout le domaine. Ces
traitements nécessitent beaucoup de calculs, c'est pour cela que \cite{Flo03}
a décidé de les approximer au travers de fonctions linéaires définies par
morceaux sur une triangulation donnée.

La coordonnnée $w_i$ associée au point $p$ est calculée en utilisant la
position du point $p$, du sommet $v_i$ et des deux sommets adjacents à $v_i$ :
$v_{i-1}$ et $v_{i+1}$ (Figure \ref{DEFcal}).

\begin{figure}[ht]
  \begin{center}
    \includegraphics[scale=0.9]{chapter2-pstricks.pdf}
    \caption[Méthode de calcul MVC] {Méthode de calcul de la coordonnée $w_i$ du point $p$ par rapport
    au sommet $v_i$}
    \label{DEFcal}
  \end{center}
\end{figure}

La méthode détermine donc ces coordonnées de la manière suivante :

\begin{equation}
  w_i = \frac{tan(\alpha_{i-1}/2) + tan(\alpha_i/2)}{\| v_i - p \|}
  \label{DEFcoo}
\end{equation}

Ces coordonnées sont normalisées :

\begin{equation}
  \lambda_i = \frac{w_i}{\sum_{j=1}^n w_j}
\end{equation}

afin d'obtenir la coordonnée MVC du point $p$ par rapport au sommet $v_i$. On
appelle l'ensemble de ces coordonnées $\{\lambda_0, \lambda_1, ...,
\lambda_n\}$ les coordonnées MVC du point $p$.

Ces formules sont correctes dans le cas où un point $p$ est strictement inclus
à l'intérieur du polygone de contrôle. Des problèmes se posent lorsqu'un point
de l'espace se trouve le long d'une arête de ce polygone. On peut facilement
détecter cette situation en regardant la valeur des angles $\alpha_{i-1}$ et
$\alpha_i$. Par exemple, quand le point $p$ se situe sur l'arête $E =
[v_i,v_{i+1}]$, l'angle $\alpha_i$ vaut $\pi$ (Figure \ref{DEFinc}). Or :

\begin{displaymath}
  \lim\limits_{x \to \pi^-} tan(\frac{x}{2}) = +\infty
\end{displaymath}

\begin{figure}[ht]
  \begin{center}
    \includegraphics[scale=0.9]{chapter2-pstricks-2.pdf}

    \caption[Cas particulier MVC] {Situation dans laquelle les
formules de calcul de coordonnées ne sont plus correctes. $\alpha_i = \pi$
quand $p$ est sur l'arête $[v_i,v_{i+1}]$.}

    \label{DEFinc}
  \end{center}
\end{figure}

Cela pose un problème par rapport au calcul donné par l'équation \ref{DEFcoo}.
Les coordonnées barycentriques généralisées établissent que les coordonnées
calculées varient de façon linéaire le long des arêtes du polygone de contrôle
et qu'elles respectent la propriété de Lagrange aux sommets du polygone : Si
$p = v_i$ alors $\lambda_i = 1$ et $\lambda_j = 0 ~\forall~ j \neq i$

En utilisant ces propriétés, on peut mettre en place un calcul de coordonnées
spécifique pour les points se trouvant le long d'une arête. Pour calculer la
coordonnée $w_j$ du point $p$ par rapport au sommet $v_j$, $p$ se trouvant le
long de l'arête $E = [v_i,v_{i+1}]$, on distingue deux cas :

\begin{itemize}

\item Soit $v_j$ n'est pas incident à $E$ ($v_j \neq v_i$ et $v_j \neq
v_{i+1}$); dans ce cas là, $\lambda_j = 0$

\item Soit $v_j$ est incident à $E$ ($v_j = v_i$ ou $v_j = v_{i+1}$); dans ce
cas $\lambda_j$ est calculé comme étant le coefficient associé au sommet $v_j$
lors du calcul du barycentre du segment E, en considérant $p$ comme étant le
barycentre.

\end{itemize}